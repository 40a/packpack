#!/usr/bin/make -f

SCRIPTDIR:=$(dir $(abspath $(lastword $(MAKEFILE_LIST))))
BUILDROOT:=$(abspath $(SCRIPTDIR)/root)
# Sanity checks
ifeq ("$(SCRIPTDIR)","$(CURDIR)")
$(error Please run ./build/build inside of the project source directory)
endif

#
# List of supported OS
#

FEDORA:=fedora-rawhide fedora24 fedora23
CENTOS:=centos7 centos6
DEBIAN:=debian-sid debian-stretch debian-jessie debian-wheezy
UBUNTU:=ubuntu-yakkety ubuntu-xenial ubuntu-wily ubuntu-trusty ubuntu-precise

DEBS:=$(DEBIAN) $(UBUNTU)
RPMS:=$(FEDORA) $(CENTOS)

# Build all RPMS and all DEBS
all: $(DEBS) $(RPMS)

tarball: $(BUILDROOT)/$(TARBALL)

fedora%:
	DISTRO=$@ BUILDDIR=$(CURDIR)/build/$@ $(SCRIPTDIR)/build.sh
centos%:
	DISTRO=$@ BUILDDIR=$(CURDIR)/build/$@ $(SCRIPTDIR)/build.sh
debian%:
	DISTRO=$@ BUILDDIR=$(CURDIR)/build/$@ $(SCRIPTDIR)/build.sh
ubuntu%:
	DISTRO=$@ BUILDDIR=$(CURDIR)/build/$@ $(SCRIPTDIR)/build.sh

clean:
	rm -rf $(BUILDROOT)

.SECONDARY: # no target is removed because it is considered intermediate
.PHONY: clean
